{"version":3,"sources":["../src/module.js"],"names":["_","kbn","MetricsPanelCtrl","Builder","Presenter","Linker","panelDefaults","defaultColor","linkIndex","displayValue","titleSize","percentSize","numberSize","thresholds","format","decimals","TrendBoxCtrl","$scope","$injector","linkSrv","defaults","panel","events","on","onInitEditMode","bind","onDataReceived","onRender","builder","presenter","linker","box","addEditorTab","unitFormats","getUnitFormats","seriesList","render","call","panelContainer","css","color","panelTitle","subitem","value","push","index","splice","links","formatFunc","valueFormats","scope","elem","attrs","ctrl","find","templateUrl"],"mappings":"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","file":"module.js","sourcesContent":["import './module.css!'\nimport _ from 'lodash'\nimport kbn from 'app/core/utils/kbn'\nimport {MetricsPanelCtrl} from 'app/plugins/sdk'\nimport {Builder} from './util/builder'\nimport {Presenter} from './util/presenter'\nimport {Linker} from './util/linker'\n\nconst panelDefaults = {\n  defaultColor: 'rgb(117, 117, 117)',\n  linkIndex: 0,\n  displayValue: 'value',\n  titleSize: '20px',\n  percentSize: '30px',\n  numberSize: '14px',\n  thresholds: [],\n  format: 'none',\n  decimals: 2\n}\n\nexport class TrendBoxCtrl extends MetricsPanelCtrl {\n  constructor ($scope, $injector, linkSrv) {\n    super($scope, $injector)\n    _.defaults(this.panel, panelDefaults)\n\n    this.events.on('init-edit-mode', this.onInitEditMode.bind(this))\n    this.events.on('data-received', this.onDataReceived.bind(this))\n    this.events.on('render', this.onRender.bind(this))\n\n    this.builder = new Builder(this.panel)\n    this.presenter = new Presenter(this.panel)\n    this.linker = new Linker(this.panel, linkSrv)\n\n    this.box = {}\n  }\n\n  onInitEditMode () {\n    this.addEditorTab('Options', 'public/plugins/btplc-trend-box-panel/editor.html')\n    this.unitFormats = kbn.getUnitFormats()\n  }\n\n  onDataReceived (seriesList) {\n    this.seriesList = seriesList\n    this.render()\n  }\n\n  onRender () {\n    this.box = this.builder.call(this.seriesList)\n    this.linker.call(this.box)\n    this.presenter.call(this.box)\n\n    this.panelContainer.css('background-color', this.box.color)\n    this.panelTitle.css('font-size', this.panel.titleSize)\n  }\n\n  onEditorSetFormat (subitem) {\n    this.panel.format = subitem.value\n    this.render()\n  }\n\n  onEditorAddThreshold () {\n    this.panel.thresholds.push({ value: 0, color: this.panel.defaultColor })\n    this.render()\n  }\n\n  onEditorRemoveThreshold (index) {\n    this.panel.thresholds.splice(index, 1)\n    this.render()\n  }\n\n  getLink () {\n    return this.panel.links[this.panel.linkIndex]\n  }\n\n  format (value, format = this.panel.format) {\n    var formatFunc = kbn.valueFormats[format]\n    return formatFunc(value, this.panel.decimals, null)\n  }\n\n  link (scope, elem, attrs, ctrl) {\n    this.panelContainer = elem.find('.panel-container')\n    this.panelTitle = elem.find('.panel-title')\n  }\n}\n\nTrendBoxCtrl.templateUrl = 'module.html'\nexport { TrendBoxCtrl as PanelCtrl }\n"]}