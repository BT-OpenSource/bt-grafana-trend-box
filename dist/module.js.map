{"version":3,"sources":["../src/module.js"],"names":["_","kbn","MetricsPanelCtrl","Builder","Presenter","panelDefaults","defaultColor","displayValue","titleSize","percentSize","numberSize","thresholds","format","decimals","TrendBoxCtrl","$scope","$injector","linkSrv","defaults","panel","events","on","onInitEditMode","bind","onDataReceived","onRender","builder","presenter","box","addEditorTab","unitFormats","getUnitFormats","seriesList","render","call","panelContainer","css","color","panelTitle","boxContainer","toggleClass","links","length","subitem","value","push","index","splice","linkInfo","getPanelLinkAnchorInfo","scopedVars","target","window","open","href","location","formatFunc","valueFormats","scope","elem","attrs","ctrl","find","onClick","templateUrl"],"mappings":"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","file":"module.js","sourcesContent":["import './module.css!'\nimport _ from 'lodash'\nimport kbn from 'app/core/utils/kbn'\nimport {MetricsPanelCtrl} from 'app/plugins/sdk'\nimport {Builder} from './util/builder'\nimport {Presenter} from './util/presenter'\n\nconst panelDefaults = {\n  defaultColor: 'rgb(117, 117, 117)',\n  displayValue: 'value',\n  titleSize: '20px',\n  percentSize: '30px',\n  numberSize: '14px',\n  thresholds: [],\n  format: 'none',\n  decimals: 2\n}\n\nexport class TrendBoxCtrl extends MetricsPanelCtrl {\n  constructor ($scope, $injector, linkSrv) {\n    super($scope, $injector)\n    _.defaults(this.panel, panelDefaults)\n\n    this.events.on('init-edit-mode', this.onInitEditMode.bind(this))\n    this.events.on('data-received', this.onDataReceived.bind(this))\n    this.events.on('render', this.onRender.bind(this))\n\n    this.builder = new Builder(this.panel)\n    this.presenter = new Presenter(this.panel)\n\n    this.box = {}\n    this.linkSrv = linkSrv\n  }\n\n  onInitEditMode () {\n    this.addEditorTab('Options', 'public/plugins/btplc-trend-box-panel/editor.html')\n    this.unitFormats = kbn.getUnitFormats()\n  }\n\n  onDataReceived (seriesList) {\n    this.seriesList = seriesList\n    this.render()\n  }\n\n  onRender () {\n    this.box = this.builder.call(this.seriesList)\n    this.presenter.call(this.box)\n\n    this.panelContainer.css('background-color', this.box.color)\n    this.panelTitle.css('font-size', this.panel.titleSize)\n    this.boxContainer.toggleClass('pointer', this.panel.links && this.panel.links.length > 0)\n  }\n\n  onEditorSetFormat (subitem) {\n    this.panel.format = subitem.value\n    this.render()\n  }\n\n  onEditorAddThreshold () {\n    this.panel.thresholds.push({ value: 0, color: this.panel.defaultColor })\n    this.render()\n  }\n\n  onEditorRemoveThreshold (index) {\n    this.panel.thresholds.splice(index, 1)\n    this.render()\n  }\n\n  onClick () {\n    if (this.panel.links === null) return\n    if (this.panel.links.length === 0) return\n\n    var linkInfo = this.linkSrv.getPanelLinkAnchorInfo(\n      this.panel.links[0], this.panel.scopedVars)\n\n    if (linkInfo.target === '_blank') {\n      window.open(linkInfo.href, '_blank')\n    } else {\n      window.location.href = '/' + linkInfo.href\n    }\n  }\n\n  format (value, format = this.panel.format) {\n    var formatFunc = kbn.valueFormats[format]\n    return formatFunc(value, this.panel.decimals, null)\n  }\n\n  link (scope, elem, attrs, ctrl) {\n    this.panelContainer = elem.find('.panel-container')\n    this.boxContainer = elem.find('.box')\n    this.panelTitle = elem.find('.panel-title')\n    this.boxContainer.on('click', this.onClick.bind(this))\n  }\n}\n\nTrendBoxCtrl.templateUrl = 'module.html'\nexport { TrendBoxCtrl as PanelCtrl }\n"]}